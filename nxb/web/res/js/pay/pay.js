define("pay/pay",["libs/template"],function(e,t,n){var a=e("libs/template"),i=0,o={},r={goods:{},bindEvent:function(){$("body").delegate(".js-tap",$.Func.TAP,function(e){var t=$(this).data("handler");r[t]&&r[t].call(this)})},modifyTitle:function(e){if(e){var t=$("body");document.title=e;var n=$('<iframe src="/favicon.ico"></iframe>').on("load",function(){setTimeout(function(){n.off("load").remove()},0)}).appendTo(t)}},productInfo:function(e){var t=this,n={jsonrpc:"2.0",method:"Fund.ProductInfo",id:54321,params:{fundid:e}};$.Func.ajax(n,function(e){var n=e.result;if(n){var o=n.goods[0].productname+"信息服务";$("#title").html(o),t.modifyTitle(o),$("#totalPrice").html(n.goods[0].actualprice),i=n.goods[0].actualprice,r.goods=n.goods;var d=a("price-template",r.goods[0]);$("#price").html(d),d=a("payment-template",n),$("#paymentList").html(d)}})},reducePeriod:function(){var e=parseInt($("#period").val())||1;e>1&&(e--,$("#period").val(e),i=r.goods[0].actualprice*e,$("#totalPrice").html(i.toFixed(2)))},addPeriod:function(){var e=parseInt($("#period").val())||1;e++,$("#period").val(e),i=r.goods[0].actualprice*e,$("#totalPrice").html(i.toFixed(2))},showPrice:function(){var e=$(this).data("productid"),t=$(this).data("number"),n=parseInt($("#period").val())||1;$("#paymentList .js-tap").removeClass("on").eq(t).addClass("on"),$("#productid").val(e),i=r.goods[t].actualprice*n,$("#totalPrice").html(i.toFixed(2));var o=a("price-template",r.goods[t]);$("#price").html(o)},createOrder:function(e,t,n){var a={jsonrpc:"2.0",method:"Fund.CreateOrderGZH",id:54321,params:{userid:$.User.userid,openid:$.User.openid,productid:e,quantity:t,channelid:1,appenv:"weixin_gzh_nxb",couponid:0}};$.Func.ajax(a,function(e){var t=e.result;t&&n&&n(t)})},payWX:function(){var e=parseInt($("#productid").val()),t=parseInt($("#period").val())||1,n=e.toString()+"-"+t.toString();return e?($("#btnLine").addClass("btnline-loading"),void(o.hasOwnProperty(n)?r.onpay(o.signType):o[n]=r.createOrder(e,t,function(e){o.signType=e,r.onpay(e)}))):($.Func.pop("请选择产品支付"),!1)},onpay:function(e){wx.ready(function(){function t(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,"package":e["package"],signType:e.signType,paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(location.href="pay_result.html?status=1&money="+i.toFixed(2)),$("#btnLine").removeClass("btnline-loading")})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t()})},init:function(){$.Func.getUserInfo(),$.Func.getJSAPI();var e=$.Func.getParam("fundid");this.productInfo(e),this.bindEvent()}};n.exports=r});