define("fund/index",["libs/chart","libs/subscribe","libs/template"],function(a,t,n){var e=a("libs/chart"),s=a("libs/subscribe"),r=a("libs/template"),i={};r.helper("numToPercent",function(a){return(100*a).toFixed(2)+"%"}),r.helper("dateFormate",function(a){var t=a.substring(0,10).split("-");return t[0]+"."+t[1]+"."+t[2]});var d={bindEvent:function(){$("body").delegate(".js-tap","click",function(a){var t=$(this).data("handler");d[t]&&d[t].call(this)})},showMore:function(a){var t=$(this).parent(),n=$(this).data("fundid"),e=$(this).data("index"),s=$("#onRange-"+e).val();t.hasClass("on")?t.removeClass("on"):(t.addClass("on"),i.hasOwnProperty(e+s)?i[e+s].paint():d.fundHistoryPctchg(n,s,e)),d.showBtn(n,e)},showTab:function(){var a=$(this).data("range").split("-"),t=a[0],n=a[1],e=$("#onRange-"+n).data("fundid");$(this).parent().children().removeClass("on"),$(this).addClass("on"),i.hasOwnProperty(n+t)?i[n+t].paint():d.fundHistoryPctchg(e,t,n)},showBtn:function(a,t){if(!$.User.wxgzh)return $("#btn-"+t).html('<a class="btn btn-red" href="bindphone.html">绑定账号并购买</a>').removeClass("hide"),!1;var n=$.User.userid;s.subscribeList(n,function(e){~$.inArray(a,e)?$("#btn-"+t).html('<a class="btn btn-red" href="detail.html?fundid='+a+'">查看详情</a>').removeClass("hide"):s.vipService(n,function(e){~$.inArray(a,e)?$("#btn-"+t).html('<a class="btn btn-red js-tap" data-handler="subscribe" data-fundid=" '+a+'" href="javascript:;">订阅</a>').removeClass("hide"):s.checkFundFreeStatus(n,a,function(n){1==n?$("#btn-"+t).html('<a class="btn btn-red js-tap" data-fundid="'+a+'" data-handler="subscribe" href="javascript:;">免费订阅</a>').removeClass("hide"):$("#btn-"+t).html('<a class="btn btn-red" href="../../pay/pay.html?fundid='+a+'">购买</a>').removeClass("hide")})})})},fundHistoryPctchg:function(a,t,n){var e=new Date,s=$.Func.formatDate(e),r=null,i=$("#create-"+n).val();switch(i=$.Func.formatDate(i),t){case"begin":r=i;break;case"year":r=$.Func.formatDate(e,"year"),parseInt(r)<parseInt(i)&&(r=i);break;case"month":r=$.Func.formatDate(e,"mon")}var c={jsonrpc:"2.0",method:"Fund.FundHistoryPctchg",id:54321,params:{Fundid:a,Pctchgtype:0,StartDay:parseInt(r),EndDay:parseInt(s)}};$.Func.ajax(c,function(a){var e=a.result;e&&d.drawCanvas(n,t,e.data)})},subscribe:function(){var a=$(this).data("fundid");return!!a&&void($.User.wxgzh?s.subscribeFund($.User.userid,a,function(a){1==a.result.status?$.Func.pop("订阅成功！"):$.Func.pop(a.result.status.msg)}):$.Func.showLayer("#popBindAccount"))},fundList:function(a){var t={jsonrpc:"2.0",method:"Fund.FundList",id:54321,params:{blockid:885494}};$.Func.ajax(t,function(t){var n=t.result;if(n.data){var e=r("li-template",n);$("#fundlist").html(e)}var s=$(window).width()-20;$(".canvas canvas").width(s),$.isFunction(a)&&a(n.data)})},hawkeye:function(){$.User.wxgzh?location.href="../hawkeye/index.html":$.Func.showLayer("#popBindAccount")},closeLayer:function(){$(this).parent().parent().removeClass("show")},drawCanvas:function(a,t,n){n[0].data&&n[1].data&&(i[a+t]=new e({selector:"#canvas-"+a,point:"pctchg",days:[{fillStyle:"#CC0153",data:n[0].data},{fillStyle:"#0166CE",data:n[1].data}]}))},init:function(){var a=this;$.Func.getUserInfo(),$.User.wxgzh||$.Func.showLayer("#popBindAccount");var t=[];a.fundList(function(a){$.each(a,function(a,n){t.push(n.fundid)})}),this.bindEvent()}};n.exports=d});